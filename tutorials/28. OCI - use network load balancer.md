# ⚖️ 28. OCI - use network load balancer

In previous tutorial we have created a load balancer for our web application. It is based on HTTP/HTTPS protocol for traffic routing. Oracle also provides a free Network Load Balancer which is working on TCP/UDP layer. If we have any service that is running on the instance other than web server, we can use it for incoming traffic.

In this tutorial I'll show how to setup the Network Load Balancer for a v2ray server. I have installed a v2ray server in both instances and they are working on the same TCP port **23933**. I want to have a balancer to accept v2ray client requests and route traffic to these two servers.

Before begin to create the balancer make sure the service is running fine in both instances, and we can access them remotely without problem.

First as we did in previous tutorial, create a security list and subnet for the balancer. Navigate to **Networking --> Virtual Cloud Networks**, click on the VCN which is running the instance. Switch to tab **Security** and create a Security List with the following:

>Name: network-load-balancer-security
>
>Source type: CIDR
>
>Source CIDR: 0.0.0.0/0
>
>IP Protocol: TCP
>
>Destination Port Range: 23933

Then we create a subnet to apply this security list. In the VCN detail page, switch to tab **Subnets** and create a subnet with the following:

>Name: network-load-balancer-subnet
>
>Subnet Type: Regional
>
>IPv4 CIDR Block: 10.0.101.0/24
>
>Subnet Access: Public Subnet
>
>Security Lists: choose **network-load-balancer-security**

Now we will create the balancer. Navigate to **Networking --> Load balancers --> Network load balancers --> Create netork load balancer**, fill in the following:

>Name: v2ray-load-balancer
>
>Choose visibility type: Public
>
>Assign a public IP address: Ephemeral IPv4 address
>
>Virtual clould network: choose VCN which has the v2ray server instaces running
>
>Subnet: choose network-load-balancer-subnet
>
>Listener name: v2ray-listener
>
>Specify the type of traffic: TCP
>
>Ingress traffic port: choose **Specify the port**
>
>Timeout: 120
>
>Port: 23933
>
>Backend set name: v2ray-backendset
>
>
>Select backends: Select the two running instances with its name and private IP address

Now the wizard comes to section **Specify health check policy**. It is similar to web load balancer where the balancer would send a request to the running service and check the expected response. I am not sure if v2ray server would respond to any request with expected message, but I know I have the web application running in the same instance. So I'll fill this section by using the web application health check info just like in previous tutorial:

>Protocol: HTTP
>
>Port: 80
>
>Interval in milliseconds: 600000
>
>URL path (URI): /api/ping
>
>Response body: pong
>
>Fail open: enable it (this makes sure that balancer keeps routing traffic even health check fails)

And for the rest of the wizard, fill in the following:

>Security list: choose **Manually configure security list rules after the network load balancer is created**
>
>Load balancing policy: choose **5-tuple hash**

Wait a minute to let the creation complete. Then we go to the detail page of this balancer, the public IP address will be displayed. We can now test our v2ray client accessing server by using this IP address.

There are various ways to verify if traffic goes to both of the instances. For example, I use command **nload ens3** to monitor network traffic in both instances. By using v2ray client for different applications from my local host, I can see network load is increasing on both instances.
