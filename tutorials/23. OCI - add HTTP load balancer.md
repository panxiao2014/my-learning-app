# ⚖️ 23. OCI - add HTTP load balancer

Oracle has offered a free HTTP load balancer. This tutorial will show how to use it.

We need at least two instances running web server to verify if load balancer will route HTTP traffic to each of them. Make sure they are using the same virtual cloud network. The load balancer should also running in this VCN, with a different subnet. So we first create a new subnet for the load balancer. Navigate to **Networking --> Virtual Cloud Networks**, click on the VCN which is used by the web server instances. Switch to **Subnets** and create a subnet.  Fill in the following:

>Name: load-balancer-subnet
>
>IPv4 CIDR Block: 10.0.100.0/24 (use a subnet address which is different from subnet of the instances)
>
>Subnet Access: choose **Public Subnet**

Then create this subnet. Note we haven't create security rules for it and we need to define them. Navigate back to the VCN page and click on the VCN which is used by the web server instances. Switch to tab **Security** and click on **Create Security List**. For Ingress, we add one rule for HTTP traffic:

>Source CIDR: 0.0.0.0/0
>
>IP Protocol: TCP
>
>Destination Port Range: 80

For Egress, we just add one rule to allow all traffic:

>Destination CIDR: 0.0.0.0/0
>
>IP Protocoal: All Protocols

To apply this security list to the subnet we created, go to the VCN page and switch to tab **Subnets**, click on the subnet created. Switch to tab **Security**, click on **Add Security List**. Note after adding this list, there is another default security list remain. We should remove it, make sure only the security list we created for this subnet is available.

Now we can create the load balancer. Navigate to **Networking --> Load balancers --> Load balancer --> Create load balancer**, fill in the following:

>Load balancer name: my-load-balancer
>
>Choose visibility type: Public
>
>Assign a public IP address: Ephemeral IP address
>
>Bandwidth: for free load balancer, choose 10
>
>Virtual clould network: choose VCN which has the web server instaces running
>
>Subnet: choose load-balancer-subnet
>
>Specify a load balancing policy: choose **Weighted round robin**
>
>Select instances: choose the two instances which are running web server
>
>Health check: if you are running the web server which we used in previous tutorials, then you can use **/api/ping** as the URL path, and **pong** as the response body regex
>
>Backend set name: my-load-balancer-backend-set
>
>Security List: choose **Manually configure security list rules after the backend servers are added** (we have already created the security list for the subnet, no more action needed here.)
>
>Listener name: my-load-balancer-http-listener
>
>Type of traffic: HTTP
>
>Error logs: choose **Create a new log group**
>
>New log group name: my-load-balancer-log-group

And wait for a minute for creating the balancer. Note, in the above steps we added two instances to the backend set. Oracle requires that they should in different availability domains. Since I have created two free instances and there is only one domain which could offer free instance so it can not meet this requirement. If we choose the two instances which are in the same domain when creating the load balancer, the final result will show error message and the creation will fail.

A workaround for this issue is that we only select one instance during the creation of the load balancer. After the load balancer is created we can add the other instance to the backend set. To do this, go to the load balancer page that we created, switch to **Backend sets**, click on the backend set we created and switch to tab **Backends**, and we can add the other instance to the backend set here.

Also in the Backends page, make sure the health status for the instance is **OK**, otherwise the load balancer won't route HTTP traffic to the instance.

Now we go back to the load balancer Details page, we could see the public IP address of it. And we can access our web server through port 80 of this address. Since we chose round robin method for routing the traffic, we could see from web server log that each HTTP request is served by an instance sequentially.