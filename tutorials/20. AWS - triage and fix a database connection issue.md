In this tutorial we'll triage an issue with the web application and fix it.

In previous tutorial we have achieved the goal to access the application from public network. When we click button "Show me a user", A user's info will be displayed. But if we keep clicking this button very quickly, we'll see the page is stop responding. Back to ECS services we'll see in the Events tab that both services report error of "Amazon ECS replaced 1 tasks due to an unhealthy status.".

To further check what caused the error, go to backend service and switch to **Tasks** tab. We will see error like the following:

*⚠️ Error getting total users: QueuePool limit of size 5 overflow 10 reached, connection timed out, timeout 30.00 (Background on this error at: https://sqlalche.me/e/20/3o7r)*

Run the application in our local host, do the same test and we'll get the same error.

It seems that our quick clicking of the button caused too many requests to the database. By reading the source code we would find the root cause is in function get_db(): it returns a database session to each HTTP request but never close the session. To fix the issue, update the function:

```
def get_db(request: Request) -> Session:
    """Dependency to get database session"""
    SessionLocal = request.app.state.db_session_factory
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()
```

Then we should go through the process of local test, code commit, CI in Github and docker image build as mentioned in previous tutorials. We need to push the updated backend image to ECR registry.

Now we can stop and run ECR service again so it will use the new docker image. This time check the application again and verify if the issue is fixed.

